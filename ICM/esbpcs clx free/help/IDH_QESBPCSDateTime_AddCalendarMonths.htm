<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
<META NAME="GENERATOR" Content="Time2HELP 1.0; Standard Template">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html;CHARSET=iso-8859-1">
<TITLE>AddCalendarMonths</TITLE>
<Style>Body, TD {font-family: "Verdana"; font-size: 10pt};
PRE {font-size: 10pt; margin-top: 0; margin-bottom: 0}
TR.odd {background-color: #F8F8F8};
TR.even {background-color: #EEEEEE};
Table.list {background-color: #FFFFFF};
TD {vertical-align : top}
</Style>
</HEAD>
<BODY BGCOLOR="#FFFFFF">
<BASEFONT NAME="verdana" Size="2"><Table Border="0" Width="100%" BGColor="#FFFFFF"><TR><TD><Font Color="#000000F"><B>AddCalendarMonths Function</B></Font></TD></TR></Table>Adds a Specified Number of Calendar Months to a Given Date/Time.<P><B>Unit</B><Br><A HREF="IDH_Unit_QESBPCSDateTime.htm">QESBPCSDateTime</A><P><B>Declaration</B><Br><Font Face="Courier New"><B>Function</B> AddCalendarMonths(<B>const</B> DT: TDateTime; <B>const</B> Months: Integer): TDateTime;</Font><P><B>Description</B><Br />Time portion preserved.</P><P>If adding Months results in landing on a nonsense date like 31 Apr then the last day in the month is used. This only applies to the integral component of the Months Added. The fractional part always is added to the resultant Date/Time.</P><P><Table Border="0" Width="100%" BGColor="#000000"><TR><TD><Font Color="#FFFFFF"><B>Parameters</B></Font></TD></TR></Table><Table Class="list" Width="100%" CellSpacing="1" CellPadding="2" BGColor="#EEEEEE"><TR Class="even"><TD><Font Color="Blue">DT&nbsp;</Font></TD><TD>Date/Time to process.</TD></TR><TR Class="odd"><TD><Font Color="Blue">Months&nbsp;</Font></TD><TD>Number of Months to Add - can be negative.</TD></TR></Table></P><P><B>Category</B><Br><A HREF="idh_cat_dtmath.htm">Date/Time Arithmetic Routines</A><Br /><A HREF="idh_cat_monthmath.htm">Month Based Arithmetic Routines</A><Br /><Font Color=#FF0000><H3>Implementation</H3></Font> <table border="0" bgcolor="#FFFED9"  style="margin-top: 10; margin-bottom: 10;"> <tr> <td><pre><B>function</B> AddCalendarMonths (<B>const</B> DT: TDateTime; <B>const</B> Months: Integer): TDateTime;
<B>var</B>
     Day, Month, Year: Integer;
     IMonth: Integer;
<B>begin</B>
     OptDecodeDateI (DT, Year, Month, Day);
     IMonth := Month + Months;

     <B>if</B> IMonth &gt; 12 <B>then</B>
     <B>begin</B>
          Year := Year + (IMonth - 1) <B>div</B> 12;
          IMonth := IMonth <B>mod</B> 12;
          <B>if</B> IMonth = 0 <B>then</B>
               IMonth := 12;
     <B>end</B>
     <B>else</B> <B>if</B> IMonth &lt; 1 <B>then</B>
     <B>begin</B>
          Year := Year + (IMonth <B>div</B> 12) - 1; <Font Color="#0000DD">// sub years;</Font>
          IMonth := 12 - abs (IMonth) <B>mod</B> 12;
     <B>end</B>;
     Month := IMonth;

     <Font Color="#0000DD">// Ensure Day of Month is valid</Font>
     <B>if</B> Month = 2 <B>then</B>
     <B>begin</B>
          <B>if</B> IsLeapYear (Year) <B>and</B> (Day &gt; 29) <B>then</B>
               Day := 29
          <B>else</B> <B>if</B> <B>not</B> IsLeapYear (Year) <B>and</B> (Day &gt; 28) <B>then</B>
               Day := 28;
     <B>end</B>
     <B>else</B> <B>if</B> (Month <B>in</B> [9, 4, 6, 11]) <B>and</B> (Day = 31) <B>then</B>
          Day := 30;

     Result := OptEncodeDateI (Year, Month, Day) + Frac (DT);
<B>End</B>;</pre></td></tr></Table><P><HR>
<TABLE BORDER="0" WIDTH="100%" BGCOLOR="#000000"><TR><TD>
<Font Color=White><Large>HTML generated by <B>Time2HELP</B></Large></Font>
</TD></TR></Table>
<Small><A HREF="http://www.time2help.com">http://www.time2help.com</A></Small></Body></HTML>